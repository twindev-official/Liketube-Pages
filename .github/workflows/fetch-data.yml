name: Fetch and Use GitHub Data Securely

on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * *'

jobs:
 fetch-and-use-data:
     runs-on: ubuntu-latest
    
    steps:
      - name: Check out repository
        uses: actions/checkout@v4

      - name: Fetch, Decode, and Load Data
        env:
          GH_TOKEN: ${{ secrets.ACCESS_TOKEN }}
        run: |
          TARGET_OWNER="Bob-2015"
          TARGET_REPO="Liketube-Official"
          TARGET_FILE_PATH="Login/accounts.txt"

          DECODED_CONTENT=$(curl -L \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: Bearer $GH_TOKEN" \
            -H "X-GitHub-Api-Version: 2022-11-28" \
            "https://api.github.com/repos/${TARGET_OWNER}/${TARGET_REPO}/contents/${TARGET_FILE_PATH}" \
            | jq -r .content | base64 --decode)

          echo "ACCOUNTS_DATA<<EOF" >> $GITHUB_ENV
          echo "$DECODED_CONTENT" >> $GITHUB_ENV
          echo "EOF" >> $GITHUB_ENV

    - name: Example Step: Use the Decoded Data
        run: |
          echo "Using the secret accounts data now..."
          
          # SAFE WAY: Write to a temporary file
          # Do NOT use 'echo "$ACCOUNTS_DATA"' as it will leak your secret.
          echo "$ACCOUNTS_DATA" > ./temp_accounts.txt
          
          # Now your script can use ./temp_accounts.txt
          LINE_COUNT=$(wc -l < ./temp_accounts.txt)
          echo "The accounts file contains $LINE_COUNT lines."

          # Clean up
          rm ./temp_accounts.txt
          echo "Temporary accounts file removed."
