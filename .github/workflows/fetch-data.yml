# This is the name of your GitHub Action
name: Fetch GitHub Data

# This controls WHEN the action runs
on:
  # 1. Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:
  
  # 2. Runs on a schedule (this example is once per day at midnight UTC)
  schedule:
    - cron: '0 0 * * *'
  
  # 3. (Optional) You can also run it every time you push to main
  # push:
  #   branches: [ "main" ]

jobs:
  # This is the name of the "job"
  fetch-data:
    # It runs on a standard virtual machine
    runs-on: ubuntu-latest
    
    # This is CRITICAL: It gives the action permission to write
    # back to your repository (to save the new JSON file)
    permissions:
      contents: write
      
    steps:
      # Step 1: Checks out your repository's code so the script can access it
      - name: Check out repository
        uses: actions/checkout@v4

      # Step 2: Create the directory to store the data, if it doesn't exist
      # We'll use a folder named `_data` to keep things tidy
      - name: Create data directory
        run: mkdir -p ./_data

      # Step 3: Fetch the API JSON for a file from another repository
      # This example fetches the 'LICENSE.txt' file from the 'godotengine/godot' repo
      - name: Fetch specific file API data}/
        run: |
          # --- !! EDIT THESE VALUES !! ---
          # Define the repository and file you want to fetch
          TARGET_OWNER="Bob-2015"
          TARGET_REPO="Liketube-Official"
          TARGET_FILE_PATH="login/accounts.txt"
          # --- !! --------------------- !!

          curl -L \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
            -H "X-GitHub-Api-Version: 2022-11-28" \
            "https://api.github.com/repos/${TARGET_OWNER}/${TARGET_REPOcontents/${TARGET_FILE_PATH}" \
            > ./_data/login/accounts.json
            
      # Step 4: Commit the new file (or changes) back to your repository
      - name: Commit and push if data changed
        run: |
          # Configure git with a bot name and email
          git config --global user.name "GitHub Action Bot"
          git config --global user.email "github-action-bot@users.noreply.github.com"
          
          # Add the file to be committed
          git add ./_data/github_file.json
          
          # Check if there are any changes to commit.
          # If there are no changes, the 'git commit' command will fail.
          # The '|| exit 0' part makes sure the workflow continues
          # successfully even if there's nothing to commit.
          git diff --staged --quiet || git commit -m "Automated: Update GitHub file data"
          
          # Push the changes back to your repository
          git push