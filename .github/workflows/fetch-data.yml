# This is the name of your GitHub Action
name: Fetch GitHub Data

# This controls WHEN the action runs
on:
  # 1. Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:
  
  # 2. Runs on a schedule (this example is once per day at midnight UTC)
  schedule:
    - cron: '0 0 * * *'

jobs:
  # This is the name of the "job"
  fetch-data:
    # It runs on a standard virtual machine
    runs-on: ubuntu-latest
    
    # This is CRITICAL: It gives the action permission to write
    # back to your repository (to save the new JSON file)
    permissions:
      contents: write
      
    steps:
      # Step 1: Checks out your repository's code so the script can access it
      - name: Check out repository
        uses: actions/checkout@v4

      # Step 2: Create the directory to store the data, if it doesn't exist
      # We'll use a folder named `_data` to keep things tidy
      - name: Create data directory
        run: mkdir -p ./_data/login

      # Step 3: Fetch the API JSON for a file from another repository
      - name: Fetch specific file API data
        run: |
          # Define the repository and file you want to fetch
          # !!! IMPORTANT: This path is case-sensitive. Check your private repo.
          TARGET_OWNER="Bob-2015"
          TARGET_REPO="Liketube-Official"
          TARGET_FILE_PATH="login/accounts.txt"

          # This command now uses the variables, making it correct
          curl -L \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: Bearer ${{ secrets.ACCESS_TOKEN }}" \
            -H "X-GitHub-Api-Version: 2022-11-28" \
            "https://api.github.com/repos/${TARGET_OWNER}/${TARGET_REPO}/contents/${TARGET_FILE_PATH}" \
            > ./_data/login/accounts.json
            
      # Step 4: Commit the new file (or changes) back to your repository
      - name: Commit and push if data changed
        run: |
          # Configure git with a bot name and email
          git config --global user.name "GitHub Action Bot"
          git config --global user.email "github-action-bot@users.noreply.github.com"
          
          # This path correctly matches the one from Step 2 and 3
          git add ./_data/login/accounts.json
          
          # Check if there are any changes to commit
          git diff --staged --quiet || git commit -m "Automated: Update GitHub file data"
          
          # Push the changes back to your repository
          git push
